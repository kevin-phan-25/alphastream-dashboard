<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ALPHASTREAM v5.9 – ROSS CAMERON</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {background:#0a1a2e;color:#fff;font-family:'Courier New';margin:0;padding:0;}
    .card{background:#1e293b;border:1px solid #00ff88;border-radius:8px;}
    .scanner-item{cursor:pointer;}
    .scanner-item:hover{background:#00ff8820;transform:scale(1.02);}
    .badge-hot{background:#ff4500;color:white;}
    .badge-cold{background:#00bfff;color:white;}
    .pattern-img{max-width:100%;height:140px;object-fit:contain;border-radius:6px;background:#111;padding:4px;}
    .logo-img{max-width:80px;margin-bottom:10px;}
    .header-title{font-size:1.8rem;font-weight:bold;color:#00ff88;}
    .subtitle{font-size:1.3rem;color:#00d4ff;margin-bottom:20px;}
  </style>
</head>
<body>
<div class="container-fluid p-3">
  <div class="text-center mb-4">
    <img src="https://i.imgur.com/8zV5b5P.png" alt="Warrior Trading Logo" class="logo-img">
    <div class="header-title">ALPHASTREAM v5.9</div>
    <div class="subtitle">ROSS CAMERON + GAP & GO</div>
  </div>

  <div class="row">
    <!-- LEFT: SCANNER + CHART -->
    <div class="col-lg-8">
      <div class="card p-3 mb-3">
        <h3>SCANNER <span id="mode-badge" class="badge badge-cold">COLD</span></h3>
        <div id="scanner" class="row g-2"></div>
      </div>

      <div class="card p-3">
        <h4>CHART: <span id="chart-symbol">—</span></h4>
        <div style="position:relative;height:420px;"><canvas id="chart"></canvas></div>
      </div>
    </div>

    <!-- RIGHT: STATS + TRADES + PATTERNS -->
    <div class="col-lg-4">
      <div class="card p-3 mb-3">
        <h5>STATS</h5>
        <div id="stats" class="small"></div>
      </div>

      <div class="card p-3 mb-3">
        <h5>RECENT TRADES</h5>
        <div id="trades" class="small"></div>
      </div>

      <div class="card p-3">
        <h5>WARRIOR TRADING PATTERNS (12)</h5>
        <div class="row g-2" id="patterns"></div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js + Candlestick Plugin -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.0/dist/chartjs-chart-financial.min.js"></script>

<script>
  // WebSocket
  const ws = new WebSocket(`wss://${location.host}`);
  let chart = null;

  ws.onmessage = e => {
    const {type, data} = JSON.parse(e.data);
    if (type === 'INIT') {
      renderScanner(data.scanner);
      renderTrades(data.trades);
      renderStats(data.stats);
    }
    if (type === 'SCANNER') renderScanner(data);
    if (type === 'TRADE') renderTrades([data, ...getTrades()].slice(0, 20));
    if (type === 'STATS') renderStats(data);
  };

  function renderScanner(list) {
    const el = document.getElementById('scanner');
    el.innerHTML = list.map(s => `
      <div class="col-6 col-md-4 col-lg-3">
        <div class="scanner-item card p-2 text-center" onclick="loadChart('${s.symbol}')">
          <strong>${s.symbol}</strong><br>
          <small>$${s.price.toFixed(2)}</small>
          ${s.strategy ? `<br><small class="text-info">${s.strategy}</small>` : ''}
        </div>
      </div>
    `).join('');
  }

  function renderTrades(list) {
    const el = document.getElementById('trades');
    el.innerHTML = list.map(t => `
      <div class="mb-1">
        <strong>${t.symbol}</strong> ${t.strategy} 
        <span class="${t.result === 'WIN' ? 'text-success' : 'text-danger'}">${t.result}</span>
        $${t.pnl.toFixed(2)}
      </div>
    `).join('');
    setTrades(list);
  }

  function getTrades() { try { return JSON.parse(localStorage.getItem('trades') || '[]'); } catch { return []; } }
  function setTrades(v) { localStorage.setItem('trades', JSON.stringify(v)); }

  function renderStats(s) {
    const badge = document.getElementById('mode-badge');
    badge.textContent = s.mode;
    badge.className = 'badge ' + (s.mode === 'HOT' ? 'badge-hot' : 'badge-cold');
    document.getElementById('stats').innerHTML = `
      Win Rate: <strong>${s.winRate.toFixed(1)}%</strong><br>
      P&L: <strong style="color:${s.pnl >= 0 ? '#0f0' : '#f55'}">$${s.pnl.toFixed(2)}</strong><br>
      Mode: <strong>${s.mode}</strong>
    `;
  }

  async function loadChart(sym) {
    document.getElementById('chart-symbol').textContent = sym;
    const resp = await fetch(`/chart/${sym}`);
    const bars = await resp.json();
    if (!chart) {
      chart = new Chart(document.getElementById('chart'), {
        type: 'candlestick',
        data: { datasets: [{ label: sym, data: [] }] },
        options: {
          animation: false,
          scales: { x: { type: 'time', time: { unit: 'minute' } } },
          plugins: { legend: { display: false } }
        }
      });
    }
    chart.data.datasets[0].data = bars.map(b => ({ x: b.t, o: b.o, h: b.h, l: b.l, c: b.c }));
    chart.update();
  }

  // === 12 WARRIOR TRADING PATTERNS (BASE64) ===
  const patterns = [
    { name: "Cover", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Bull Flag Breakout Pattern", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Cover (2)", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Bull Flag Breakout Pattern (2)", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Cover (3)", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Bull Flag Breakout Pattern (3)", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    // Repeat or add real ones below — these are placeholders
    { name: "Bull Flag (1a)", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Bull Flag 5min then 1min (1b)", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Bear Flag Breakdown (1-min)", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Bear Flag Breakdown (5-min)", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "Flat Top Breakout", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." },
    { name: "False Breakout Trap", src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAKACAYAAABK..." }
  ];

  // Render patterns
  document.getElementById('patterns').innerHTML = patterns.map(p => `
    <div class="col-6">
      <img class="pattern-img" src="${p.src}" alt="${p.name}">
      <small class="d-block text-center text-info">${p.name}</small>
    </div>
  `).join('');
</script>
</body>
</html>
